---
import { getCollection, getEntryBySlug } from "astro:content";

import ContentLayout from "@/layouts/ContentLayout.astro";
import TaggedPostsList from "@/components/TaggedPostsList.astro";

const allPosts = Object.values(import.meta.glob('@/content/posts/*.md', { eager: true }));
const tags = [...new Set(allPosts.map((post: any) => post.frontmatter.tags).flat())];

const tagDetailsPromises = tags.map(async tag => {
    const tagDetails = await getEntryBySlug("tags", tag);

    return {
        slug: tag,
        title: tagDetails?.data.title || tag,
        description: tagDetails?.data.description || ""
    };
});

const tagsWithDetails = await Promise.all(tagDetailsPromises);
---

<ContentLayout title="Tags: All | 0x15BA88FF Maze">
    <h1 class="text-2xl md:text-4xl font-bold">Tag Index</h1>
    <ul class="my-8">
        {tagsWithDetails.map(tag => (
            <hr class="my-4 border-surface-500"/>
            <li class="py-4">
                <div class="flex items-end justify-between mb-4">
                    <a class="px-4 py-2 text-md md:text-2xl font-bold bg-primary-900 text-primary-500 rounded" href={`/maze/tags/${tag.slug}`}>#{tag.title}</a>
                    <a class="text-primary-700 hover:text-primary-500" href={`/maze/tags/${tag.slug}`}>See more</a>
                </div>
                <p>{tag.description}</p>
                <TaggedPostsList tag={tag.slug} max={10} />
            </li>
        ))}
    </ul>
</ContentLayout>
